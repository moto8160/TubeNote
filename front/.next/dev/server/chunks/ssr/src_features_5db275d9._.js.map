{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/WORK/youtube-post/front/src/features/videos/video.server.ts"],"sourcesContent":["'use server';\r\nimport { VideoListResponse, YoutubeOEmbedResponse } from '../videos/video.type';\r\n\r\nexport async function fetchVideos(): Promise<VideoListResponse[]> {\r\n  const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/videos`);\r\n\r\n  if (!res.ok) {\r\n    throw new Error('Failed to fetch videos');\r\n  }\r\n\r\n  return res.json();\r\n}\r\n\r\nexport async function fetchVideoDetail(videoId: string): Promise<VideoListResponse[]> {\r\n  const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/videos/${videoId}`);\r\n  const json = await res.json();\r\n\r\n  if (!res.ok) {\r\n    throw new Error(json.message ?? 'Failed to fetch video');\r\n  }\r\n\r\n  return json;\r\n}\r\n\r\nexport async function fetchOEmbed(videoUrl: string): Promise<YoutubeOEmbedResponse> {\r\n  const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/videos/preview`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ videoUrl }),\r\n  });\r\n  const json = await res.json();\r\n\r\n  if (!res.ok) {\r\n    throw new Error(json.message ?? 'Failed to fetch video Preview');\r\n  }\r\n\r\n  return json;\r\n}\r\n"],"names":[],"mappings":";;;;;;;IAwBsB,cAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA"}},
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/WORK/youtube-post/front/src/features/posts/post.server.ts"],"sourcesContent":["'use server';\r\nimport { fetchWithToken } from '@/utils/fetchWithToken';\r\nimport { PostListResponse } from './post.type';\r\n\r\nexport async function fetchPosts(): Promise<PostListResponse[]> {\r\n  const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/posts`);\r\n\r\n  if (!res.ok) {\r\n    throw new Error('Failed to fetch posts');\r\n  }\r\n\r\n  return res.json();\r\n}\r\n\r\nexport async function createPost(formData: FormData) {\r\n  const videoUrl = formData.get('url');\r\n  const text = formData.get('text');\r\n\r\n  const res = await fetchWithToken(`${process.env.NEXT_PUBLIC_API_URL}/posts`, {\r\n    method: 'POST',\r\n    body: JSON.stringify({ videoUrl, text }),\r\n  });\r\n\r\n  const json = await res.json();\r\n\r\n  if (!res.ok) {\r\n    throw new Error(json.message);\r\n  }\r\n\r\n  return json;\r\n}\r\n"],"names":[],"mappings":";;;;;;;IAcsB,aAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA"}},
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/WORK/youtube-post/front/src/features/posts/components/PostForm.tsx"],"sourcesContent":["'use client';\r\nimport { YoutubeOEmbedResponse } from '@/features/videos/video.type';\r\nimport { startTransition, useEffect, useState } from 'react';\r\nimport Image from 'next/image';\r\nimport { fetchOEmbed } from '@/features/videos/video.server';\r\nimport { createPost } from '@/features/posts/post.server';\r\nimport { redirect } from 'next/navigation';\r\n\r\nexport default function PostForm() {\r\n  const [url, setUrl] = useState('');\r\n  const [text, setText] = useState('');\r\n  const [video, setVideo] = useState<YoutubeOEmbedResponse | null>(null);\r\n  const [urlMessage, setUrlMessage] = useState('');\r\n  const [message, setMessage] = useState('');\r\n\r\n  // URL入力が変わる毎にフェッチ（500msでデバウンス）\r\n  useEffect(() => {\r\n    if (!url) return;\r\n\r\n    const timer = setTimeout(() => {\r\n      // Server Actions\r\n      startTransition(async () => {\r\n        try {\r\n          // 動画のプレビューを取得\r\n          const video = await fetchOEmbed(url);\r\n          setVideo(video);\r\n          setUrlMessage('');\r\n        } catch (e) {\r\n          if (e instanceof Error) {\r\n            setUrlMessage(e.message);\r\n            setVideo(null);\r\n          } else {\r\n            setUrlMessage('エラーが発生しました');\r\n          }\r\n        }\r\n      });\r\n    }, 500);\r\n\r\n    // クリーンアップ\r\n    return () => {\r\n      clearTimeout(timer);\r\n    };\r\n  }, [url]);\r\n\r\n  return (\r\n    <div className=\"shadow-sm rounded-xl p-10\">\r\n      <form\r\n        // Server Actions\r\n        action={async (formData: FormData) => {\r\n          try {\r\n            await createPost(formData);\r\n          } catch (e) {\r\n            if (e instanceof Error) {\r\n              setMessage(e.message);\r\n            } else {\r\n              setMessage('エラーが発生しました');\r\n            }\r\n            return;\r\n          }\r\n          redirect('/videos?success=2');\r\n        }}\r\n      >\r\n        {/* メッセージ */}\r\n        {message && (\r\n          <p className=\"bg-red-100 text-red-700 p-4 rounded-md mb-4 text-sm\">{message}</p>\r\n        )}\r\n\r\n        {/* URL */}\r\n        <div>\r\n          <label className=\"block text-sm font-medium mb-2\">YouTube URL</label>\r\n          <input\r\n            name=\"url\"\r\n            value={url}\r\n            onChange={(e) => setUrl(e.target.value)}\r\n            placeholder=\"https://www.youtube.com/watch?v=...\"\r\n            className=\"w-full rounded-lg border border-gray-500 shadow-sm p-1.5 text-sm\"\r\n          />\r\n          <div className=\"min-h-6\">\r\n            {urlMessage && <p className=\"text-red-500 text-sm ml-2 mt-1\">{urlMessage}</p>}\r\n          </div>\r\n        </div>\r\n\r\n        {/* プレビュー */}\r\n        <div className=\"rounded-xl border border-gray-500 shadow-sm bg-gray-50 p-4 min-h-40 mb-8\">\r\n          {video ? (\r\n            <div className=\"flex gap-6\">\r\n              <div className=\"relative w-60 aspect-video shrink-0\">\r\n                <Image\r\n                  src={video.thumbnail_url}\r\n                  alt={video.title}\r\n                  fill\r\n                  className=\"object-cover rounded-lg\"\r\n                />\r\n              </div>\r\n              <div className=\"flex flex-col justify-center\">\r\n                <p className=\"font-medium\">{video.title}</p>\r\n                <p className=\"text-sm mt-4\">{video.author_name}</p>\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            <p className=\"text-sm text-gray-400\">URL入力後、動画のプレビューを表示します</p>\r\n          )}\r\n        </div>\r\n\r\n        {/* テキスト */}\r\n        <div>\r\n          <label className=\"block text-sm font-medium mb-2\">学習メモ</label>\r\n          <textarea\r\n            name=\"text\"\r\n            value={text}\r\n            onChange={(e) => setText(e.target.value)}\r\n            placeholder=\"動画を見て学んだことや記録しておきたいことを自由に書いてください\"\r\n            className=\"w-full whitespace-pre-wrap rounded-lg border border-gray-500 shadow-sm p-3 text-xl min-h-120\"\r\n          />\r\n        </div>\r\n\r\n        {/* ボタン */}\r\n        <button className=\"rounded-lg bg-blue-400 text-white px-4 py-2 mt-4 hover:bg-blue-500 transition\">\r\n          投稿する\r\n        </button>\r\n      </form>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AANA;;;;;;;AAQe,SAAS;IACtB,MAAM,CAAC,KAAK,OAAO,GAAG,IAAA,iNAAQ,EAAC;IAC/B,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAC;IACjC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAA+B;IACjE,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAAC;IAC7C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IAEvC,+BAA+B;IAC/B,IAAA,kNAAS,EAAC;QACR,IAAI,CAAC,KAAK;QAEV,MAAM,QAAQ,WAAW;YACvB,iBAAiB;YACjB,IAAA,wNAAe,EAAC;gBACd,IAAI;oBACF,cAAc;oBACd,MAAM,QAAQ,MAAM,IAAA,gLAAW,EAAC;oBAChC,SAAS;oBACT,cAAc;gBAChB,EAAE,OAAO,GAAG;oBACV,IAAI,aAAa,OAAO;wBACtB,cAAc,EAAE,OAAO;wBACvB,SAAS;oBACX,OAAO;wBACL,cAAc;oBAChB;gBACF;YACF;QACF,GAAG;QAEH,UAAU;QACV,OAAO;YACL,aAAa;QACf;IACF,GAAG;QAAC;KAAI;IAER,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YACC,iBAAiB;YACjB,QAAQ,OAAO;gBACb,IAAI;oBACF,MAAM,IAAA,8KAAU,EAAC;gBACnB,EAAE,OAAO,GAAG;oBACV,IAAI,aAAa,OAAO;wBACtB,WAAW,EAAE,OAAO;oBACtB,OAAO;wBACL,WAAW;oBACb;oBACA;gBACF;gBACA,IAAA,8IAAQ,EAAC;YACX;;gBAGC,yBACC,8OAAC;oBAAE,WAAU;8BAAuD;;;;;;8BAItE,8OAAC;;sCACC,8OAAC;4BAAM,WAAU;sCAAiC;;;;;;sCAClD,8OAAC;4BACC,MAAK;4BACL,OAAO;4BACP,UAAU,CAAC,IAAM,OAAO,EAAE,MAAM,CAAC,KAAK;4BACtC,aAAY;4BACZ,WAAU;;;;;;sCAEZ,8OAAC;4BAAI,WAAU;sCACZ,4BAAc,8OAAC;gCAAE,WAAU;0CAAkC;;;;;;;;;;;;;;;;;8BAKlE,8OAAC;oBAAI,WAAU;8BACZ,sBACC,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAI,WAAU;0CACb,cAAA,8OAAC,wIAAK;oCACJ,KAAK,MAAM,aAAa;oCACxB,KAAK,MAAM,KAAK;oCAChB,IAAI;oCACJ,WAAU;;;;;;;;;;;0CAGd,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAE,WAAU;kDAAe,MAAM,KAAK;;;;;;kDACvC,8OAAC;wCAAE,WAAU;kDAAgB,MAAM,WAAW;;;;;;;;;;;;;;;;;6CAIlD,8OAAC;wBAAE,WAAU;kCAAwB;;;;;;;;;;;8BAKzC,8OAAC;;sCACC,8OAAC;4BAAM,WAAU;sCAAiC;;;;;;sCAClD,8OAAC;4BACC,MAAK;4BACL,OAAO;4BACP,UAAU,CAAC,IAAM,QAAQ,EAAE,MAAM,CAAC,KAAK;4BACvC,aAAY;4BACZ,WAAU;;;;;;;;;;;;8BAKd,8OAAC;oBAAO,WAAU;8BAAgF;;;;;;;;;;;;;;;;;AAM1G"}}]
}